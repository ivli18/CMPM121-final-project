{"version":3,"file":"index-D28_gpU4.js","sources":["../../src/gl/GLContext.ts","../../src/core/Engine.ts","../../src/gl/Shader.ts","../../node_modules/gl-matrix/esm/common.js","../../node_modules/gl-matrix/esm/mat4.js","../../node_modules/gl-matrix/esm/vec3.js","../../src/core/Input.ts","../../src/main.ts"],"sourcesContent":["// canvas + webgl context\n\n// Wrapper for a WebGL context and its associated canvas\nexport class GLContext {\n  public readonly canvas: HTMLCanvasElement;\n  public readonly gl: WebGL2RenderingContext;\n\n  constructor(canvas: HTMLCanvasElement) {\n    if (!canvas) {\n      throw new Error(\"Canvas element is undefined.\");\n    }\n    this.canvas = canvas;\n    const gl = canvas.getContext(\"webgl2\");\n    if (!gl) {\n      throw new Error(\n        \"Unable to initialize WebGL. Your browser may not support it.\",\n      );\n    }\n\n    this.gl = gl;\n    this.configure();\n    self.addEventListener(\"resize\", () => this.resize());\n    this.resize();\n  }\n  private configure() {\n    const gl = this.gl;\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthFunc(gl.LEQUAL);\n    gl.clearColor(0.5, 0.7, 1.0, 1.0);\n    gl.clearDepth(1.0);\n    gl.enable(gl.CULL_FACE);\n    gl.cullFace(gl.BACK);\n  }\n  resize() {\n    const canvas = this.canvas;\n    const displayWidth = canvas.clientWidth;\n    const displayHeight = canvas.clientHeight;\n\n    if (canvas.width !== displayWidth || canvas.height !== displayHeight) {\n      canvas.width = displayWidth;\n      canvas.height = displayHeight;\n    }\n    this.gl.viewport(0, 0, canvas.width, canvas.height);\n  }\n  clear(r = 0.1, g = 0.1, b = 0.12, a = 1.0) {\n    const gl = this.gl;\n    gl.clearColor(r, g, b, a);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n  }\n}\n","// Game Loop: manages the update and render cycles.\n\nexport class Engine {\n  private lastTime = 0;\n  private running = false;\n\n  // tick: function to call each frame with delta time\n  constructor(private tick: (deltaTime: number) => void) {}\n\n  start() {\n    if (this.running) return;\n    this.running = true;\n    this.lastTime = performance.now();\n    requestAnimationFrame(this.frame);\n  }\n\n  stop() {\n    this.running = false;\n  }\n\n  private frame = (time: number) => {\n    if (!this.running) return;\n    // ms to seconds\n    const deltaTime = (time - this.lastTime) / 1000;\n    this.lastTime = time;\n\n    // clamp deltaTime to avoid large jumps if the tab is backgrounded\n    const safeDeltaTime = Math.min(deltaTime, 0.1); // max 100ms\n\n    this.tick(safeDeltaTime);\n\n    requestAnimationFrame(this.frame);\n  };\n}\n","// Shaders\nexport class Shader {\n  private program: WebGLProgram;\n\n  constructor(\n    private gl: WebGL2RenderingContext,\n    vertexSource: string,\n    fragmentSource: string,\n  ) {\n    const vs = this.compileShader(vertexSource, gl.VERTEX_SHADER);\n    const fs = this.compileShader(fragmentSource, gl.FRAGMENT_SHADER);\n\n    const program = gl.createProgram();\n    if (!program) throw new Error(\"Failed to create WebGLProgram\");\n\n    gl.attachShader(program, vs);\n    gl.attachShader(program, fs);\n    gl.linkProgram(program);\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      const info = gl.getProgramInfoLog(program);\n      gl.deleteProgram(program);\n      throw new Error(\"Failed to link program: \" + info);\n    }\n\n    gl.deleteShader(vs);\n    gl.deleteShader(fs);\n\n    this.program = program;\n  }\n\n  use() {\n    this.gl.useProgram(this.program);\n  }\n\n  getProgram(): WebGLProgram {\n    return this.program;\n  }\n\n  getUniformLocation(name: string): WebGLUniformLocation | null {\n    return this.gl.getUniformLocation(this.program, name);\n  }\n\n  private compileShader(source: string, type: number): WebGLShader {\n    const shader = this.gl.createShader(type);\n    if (!shader) throw new Error(\"Failed to create shader\");\n    this.gl.shaderSource(shader, source);\n    this.gl.compileShader(shader);\n\n    if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n      const info = this.gl.getShaderInfoLog(shader);\n      this.gl.deleteShader(shader);\n      throw new Error(\"Failed to compile shader: \" + info);\n    }\n\n    return shader;\n  }\n}\n","/**\n * Common utilities\n * @module glMatrix\n */\n\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== \"undefined\" ? Float32Array : Array;\nexport var RANDOM = Math.random;\nexport var ANGLE_ORDER = \"zyx\";\n\n/**\n * Symmetric round\n * see https://www.npmjs.com/package/round-half-up-symmetric#user-content-detailed-background\n *\n * @param {Number} a value to round\n */\nexport function round(a) {\n  if (a >= 0) return Math.round(a);\n  return a % 0.5 === 0 ? Math.floor(a) : Math.round(a);\n}\n\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\nvar radian = 180 / Math.PI;\n\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\nexport function toRadian(a) {\n  return a * degree;\n}\n\n/**\n * Convert Radian To Degree\n *\n * @param {Number} a Angle in Radians\n */\nexport function toDegree(a) {\n  return a * radian;\n}\n\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a          The first number to test.\n * @param {Number} b          The second number to test.\n * @param {Number} tolerance  Absolute or relative tolerance (default glMatrix.EPSILON)\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\nexport function equals(a, b) {\n  var tolerance = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : EPSILON;\n  return Math.abs(a - b) <= tolerance * Math.max(1, Math.abs(a), Math.abs(b));\n}","import * as glMatrix from \"./common.js\";\n\n/**\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\n * @module mat4\n */\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n    var a12 = a[6],\n      a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n  return out;\n}\n\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4 | null} out, or null if source matrix is not invertible\n */\nexport function invert(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32;\n\n  // Calculate the determinant\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  if (!det) {\n    return null;\n  }\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\nexport function adjoint(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32;\n  out[0] = a11 * b11 - a12 * b10 + a13 * b09;\n  out[1] = a02 * b10 - a01 * b11 - a03 * b09;\n  out[2] = a31 * b05 - a32 * b04 + a33 * b03;\n  out[3] = a22 * b04 - a21 * b05 - a23 * b03;\n  out[4] = a12 * b08 - a10 * b11 - a13 * b07;\n  out[5] = a00 * b11 - a02 * b08 + a03 * b07;\n  out[6] = a32 * b02 - a30 * b05 - a33 * b01;\n  out[7] = a20 * b05 - a22 * b02 + a23 * b01;\n  out[8] = a10 * b10 - a11 * b08 + a13 * b06;\n  out[9] = a01 * b08 - a00 * b10 - a03 * b06;\n  out[10] = a30 * b04 - a31 * b02 + a33 * b00;\n  out[11] = a21 * b02 - a20 * b04 - a23 * b00;\n  out[12] = a11 * b07 - a10 * b09 - a12 * b06;\n  out[13] = a00 * b09 - a01 * b07 + a02 * b06;\n  out[14] = a31 * b01 - a30 * b03 - a32 * b00;\n  out[15] = a20 * b03 - a21 * b01 + a22 * b00;\n  return out;\n}\n\n/**\n * Calculates the determinant of a mat4\n *\n * @param {ReadonlyMat4} a the source matrix\n * @returns {Number} determinant of a\n */\nexport function determinant(a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n  var b0 = a00 * a11 - a01 * a10;\n  var b1 = a00 * a12 - a02 * a10;\n  var b2 = a01 * a12 - a02 * a11;\n  var b3 = a20 * a31 - a21 * a30;\n  var b4 = a20 * a32 - a22 * a30;\n  var b5 = a21 * a32 - a22 * a31;\n  var b6 = a00 * b5 - a01 * b4 + a02 * b3;\n  var b7 = a10 * b5 - a11 * b4 + a12 * b3;\n  var b8 = a20 * b2 - a21 * b1 + a22 * b0;\n  var b9 = a30 * b2 - a31 * b1 + a32 * b0;\n\n  // Calculate the determinant\n  return a13 * b6 - a03 * b7 + a33 * b8 - a23 * b9;\n}\n\n/**\n * Multiplies two mat4s\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3];\n  var a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7];\n  var a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11];\n  var a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15];\n\n  // Cache only the current line of the second matrix\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to translate\n * @param {ReadonlyVec3} v vector to translate by\n * @returns {mat4} out\n */\nexport function translate(out, a, v) {\n  var x = v[0],\n    y = v[1],\n    z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n  return out;\n}\n\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {ReadonlyVec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\nexport function scale(out, a, v) {\n  var x = v[0],\n    y = v[1],\n    z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n\n/**\n * Rotates a mat4 by the given angle around the given axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n    y = axis[1],\n    z = axis[2];\n  var len = Math.sqrt(x * x + y * y + z * z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11];\n\n  // Construct the elements of the rotation matrix\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c;\n\n  // Perform rotation-specific matrix multiplication\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the X axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the Y axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n\n/**\n * Rotates a matrix by the given angle around the Z axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  // Perform axis-specific matrix multiplication\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.scale(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Scaling vector\n * @returns {mat4} out\n */\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a given angle around a given axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotate(dest, dest, rad, axis);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n    y = axis[1],\n    z = axis[2];\n  var len = Math.sqrt(x * x + y * y + z * z);\n  var s, c, t;\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n\n  // Perform rotation-specific matrix multiplication\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the X axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateX(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the Y axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateY(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from the given angle around the Z axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateZ(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n\n  // Perform axis-specific matrix multiplication\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a quaternion rotation and vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *     let quatMat = mat4.create();\n *     mat4.fromQuat(quatMat, quat);\n *     mat4.multiply(dest, dest, quatMat);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a new mat4 from a dual quat.\n *\n * @param {mat4} out Matrix\n * @param {ReadonlyQuat2} a Dual Quaternion\n * @returns {mat4} mat4 receiving operation result\n */\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n    by = -a[1],\n    bz = -a[2],\n    bw = a[3],\n    ax = a[4],\n    ay = a[5],\n    az = a[6],\n    aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw;\n  //Only scale if it makes sense\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n\n/**\n * Returns the translation vector component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslation,\n *  the returned vector will be the same as the translation vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive translation component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n\n/**\n * Returns the scaling factor component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslationScale\n *  with a normalized Quaternion parameter, the returned vector will be\n *  the same as the scaling vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive scaling factor component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\n  out[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\n  out[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\n  return out;\n}\n\n/**\n * Returns a quaternion representing the rotational component\n *  of a transformation matrix. If a matrix is built with\n *  fromRotationTranslation, the returned quaternion will be the\n *  same as the quaternion originally supplied.\n * @param {quat} out Quaternion to receive the rotation component\n * @param {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {quat} out\n */\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n  return out;\n}\n\n/**\n * Decomposes a transformation matrix into its rotation, translation\n * and scale components. Returns only the rotation component\n * @param  {quat} out_r Quaternion to receive the rotation component\n * @param  {vec3} out_t Vector to receive the translation vector\n * @param  {vec3} out_s Vector to receive the scaling factor\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @returns {quat} out_r\n */\nexport function decompose(out_r, out_t, out_s, mat) {\n  out_t[0] = mat[12];\n  out_t[1] = mat[13];\n  out_t[2] = mat[14];\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out_s[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\n  out_s[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\n  out_s[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\n  var is1 = 1 / out_s[0];\n  var is2 = 1 / out_s[1];\n  var is3 = 1 / out_s[2];\n  var sm11 = m11 * is1;\n  var sm12 = m12 * is2;\n  var sm13 = m13 * is3;\n  var sm21 = m21 * is1;\n  var sm22 = m22 * is2;\n  var sm23 = m23 * is3;\n  var sm31 = m31 * is1;\n  var sm32 = m32 * is2;\n  var sm33 = m33 * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out_r[3] = 0.25 * S;\n    out_r[0] = (sm23 - sm32) / S;\n    out_r[1] = (sm31 - sm13) / S;\n    out_r[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out_r[3] = (sm23 - sm32) / S;\n    out_r[0] = 0.25 * S;\n    out_r[1] = (sm12 + sm21) / S;\n    out_r[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out_r[3] = (sm31 - sm13) / S;\n    out_r[0] = (sm12 + sm21) / S;\n    out_r[1] = 0.25 * S;\n    out_r[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out_r[3] = (sm12 - sm21) / S;\n    out_r[0] = (sm31 + sm13) / S;\n    out_r[1] = (sm23 + sm32) / S;\n    out_r[2] = 0.25 * S;\n  }\n  return out_r;\n}\n\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *     let quatMat = mat4.create();\n *     mat4.fromQuat(quatMat, quat);\n *     mat4.multiply(dest, dest, quatMat);\n *     mat4.scale(dest, dest, scale)\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @returns {mat4} out\n */\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *     mat4.translate(dest, dest, origin);\n *     let quatMat = mat4.create();\n *     mat4.fromQuat(quatMat, quat);\n *     mat4.multiply(dest, dest, quatMat);\n *     mat4.scale(dest, dest, scale)\n *     mat4.translate(dest, dest, negativeOrigin);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @param {ReadonlyVec3} o The origin vector around which to scale and rotate\n * @returns {mat4} out\n */\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Calculates a 4x4 matrix from the given quaternion\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat4} out\n */\nexport function fromQuat(out, q) {\n  var x = q[0],\n    y = q[1],\n    z = q[2],\n    w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Generates a frustum matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Number} left Left bound of the frustum\n * @param {Number} right Right bound of the frustum\n * @param {Number} bottom Bottom bound of the frustum\n * @param {Number} top Top bound of the frustum\n * @param {Number} near Near bound of the frustum\n * @param {Number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n\n/**\n * Generates a perspective projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\nexport function perspectiveNO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2);\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n  if (far != null && far !== Infinity) {\n    var nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n  return out;\n}\n\n/**\n * Alias for {@link mat4.perspectiveNO}\n * @function\n */\nexport var perspective = perspectiveNO;\n\n/**\n * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\nexport function perspectiveZO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2);\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n  if (far != null && far !== Infinity) {\n    var nf = 1 / (near - far);\n    out[10] = far * nf;\n    out[14] = far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -near;\n  }\n  return out;\n}\n\n/**\n * Generates a perspective projection matrix with the given field of view.\n * This is primarily useful for generating projection matrices to be used\n * with the still experiemental WebVR API.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function orthoNO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Alias for {@link mat4.orthoNO}\n * @function\n */\nexport var ortho = orthoNO;\n\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function orthoZO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = near * nf;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Generates a matrix that makes something look at something else.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} target Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n    eyey = eye[1],\n    eyez = eye[2],\n    upx = up[0],\n    upy = up[1],\n    upz = up[2];\n  var z0 = eyex - target[0],\n    z1 = eyey - target[1],\n    z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n  var x0 = upy * z2 - upz * z1,\n    x1 = upz * z0 - upx * z2,\n    x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n\n/**\n * Returns a string representation of a mat4\n *\n * @param {ReadonlyMat4} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\nexport function str(a) {\n  return \"mat4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \", \" + a[9] + \", \" + a[10] + \", \" + a[11] + \", \" + a[12] + \", \" + a[13] + \", \" + a[14] + \", \" + a[15] + \")\";\n}\n\n/**\n * Returns Frobenius norm of a mat4\n *\n * @param {ReadonlyMat4} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\nexport function frob(a) {\n  return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2] + a[3] * a[3] + a[4] * a[4] + a[5] * a[5] + a[6] * a[6] + a[7] * a[7] + a[8] * a[8] + a[9] * a[9] + a[10] * a[10] + a[11] * a[11] + a[12] * a[12] + a[13] * a[13] + a[14] * a[14] + a[15] * a[15]);\n}\n\n/**\n * Adds two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat4} out\n */\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n\n/**\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat4} out the receiving vector\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat4} out\n */\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1],\n    a2 = a[2],\n    a3 = a[3];\n  var a4 = a[4],\n    a5 = a[5],\n    a6 = a[6],\n    a7 = a[7];\n  var a8 = a[8],\n    a9 = a[9],\n    a10 = a[10],\n    a11 = a[11];\n  var a12 = a[12],\n    a13 = a[13],\n    a14 = a[14],\n    a15 = a[15];\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3];\n  var b4 = b[4],\n    b5 = b[5],\n    b6 = b[6],\n    b7 = b[7];\n  var b8 = b[8],\n    b9 = b[9],\n    b10 = b[10],\n    b11 = b[11];\n  var b12 = b[12],\n    b13 = b[13],\n    b14 = b[14],\n    b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link mat4.subtract}\n * @function\n */\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n  return out;\n}\n\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.sqrt(x * x + y * y + z * z);\n}\n\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n\n/**\n * symmetric round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\nexport function round(out, a) {\n  out[0] = glMatrix.round(a[0]);\n  out[1] = glMatrix.round(a[1]);\n  out[2] = glMatrix.round(a[2]);\n  return out;\n}\n\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.sqrt(x * x + y * y + z * z);\n}\n\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\nexport function cross(out, a, b) {\n  var ax = a[0],\n    ay = a[1],\n    az = a[2];\n  var bx = b[0],\n    by = b[1],\n    bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n\n/**\n * Performs a spherical linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function slerp(out, a, b, t) {\n  var angle = Math.acos(Math.min(Math.max(dot(a, b), -1), 1));\n  var sinTotal = Math.sin(angle);\n  var ratioA = Math.sin((1 - t) * angle) / sinTotal;\n  var ratioB = Math.sin(t * angle) / sinTotal;\n  out[0] = ratioA * a[0] + ratioB * b[0];\n  out[1] = ratioA * a[1] + ratioB * b[1];\n  out[2] = ratioA * a[2] + ratioB * b[2];\n  return out;\n}\n\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec3} out\n */\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n    y = a[1],\n    z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n    y = a[1],\n    z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q normalized quaternion to transform with\n * @returns {vec3} out\n */\nexport function transformQuat(out, a, q) {\n  // Fast Vector Rotation using Quaternions by Robert Eisele\n  // https://raw.org/proof/vector-rotation-using-quaternions/\n\n  var qx = q[0],\n    qy = q[1],\n    qz = q[2],\n    qw = q[3];\n  var vx = a[0],\n    vy = a[1],\n    vz = a[2];\n\n  // t = q x v\n  var tx = qy * vz - qz * vy;\n  var ty = qz * vx - qx * vz;\n  var tz = qx * vy - qy * vx;\n\n  // t = 2t\n  tx = tx + tx;\n  ty = ty + ty;\n  tz = tz + tz;\n\n  // v + w t + q x t\n  out[0] = vx + qw * tx + qy * tz - qz * ty;\n  out[1] = vy + qw * ty + qz * tx - qx * tz;\n  out[2] = vz + qw * tz + qx * ty - qy * tx;\n  return out;\n}\n\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n    r = [];\n  //Translate point to the origin\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2];\n\n  //perform rotation\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad);\n\n  //translate to correct position\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n    r = [];\n  //Translate point to the origin\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2];\n\n  //perform rotation\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad);\n\n  //translate to correct position\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n    r = [];\n  //Translate point to the origin\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2];\n\n  //perform rotation\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2];\n\n  //translate to correct position\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\nexport function angle(a, b) {\n  var ax = a[0],\n    ay = a[1],\n    az = a[2],\n    bx = b[0],\n    by = b[1],\n    bz = b[2],\n    mag = Math.sqrt((ax * ax + ay * ay + az * az) * (bx * bx + by * by + bz * bz)),\n    cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nexport function equals(a, b) {\n  var a0 = a[0],\n    a1 = a[1],\n    a2 = a[2];\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\nexport var sub = subtract;\n\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\nexport var mul = multiply;\n\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\nexport var div = divide;\n\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\nexport var dist = distance;\n\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\nexport var sqrDist = squaredDistance;\n\n/**\n * Alias for {@link vec3.length}\n * @function\n */\nexport var len = length;\n\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\nexport var sqrLen = squaredLength;\n\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n    if (!stride) {\n      stride = 3;\n    }\n    if (!offset) {\n      offset = 0;\n    }\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n    return a;\n  };\n}();","// Keyboard and Mouse & Gamepad Input Handling.\n\ntype Key = string; // e.g. \"KeyW\", \"Space\", \"ArrowLeft\"\n\nexport class Input {\n  private static initialized = false;\n\n  private static keysDown = new Set<Key>();\n  private static keysPressed = new Set<Key>();\n  private static keysReleased = new Set<Key>();\n\n  static init(target: Window = window): void {\n    if (this.initialized) return;\n    this.initialized = true;\n\n    target.addEventListener(\"keydown\", (e) => {\n      if (!this.keysDown.has(e.code)) {\n        this.keysPressed.add(e.code);\n      }\n      this.keysDown.add(e.code);\n    });\n\n    target.addEventListener(\"keyup\", (e) => {\n      this.keysDown.delete(e.code);\n      this.keysReleased.add(e.code);\n    });\n\n    // can expand with mouse and gamepad events later\n  }\n  static simulateKeyPress(key: string) {\n    this.keysPressed.add(key);\n  }\n  static update(): void {\n    this.keysPressed.clear();\n    this.keysReleased.clear();\n  }\n  static isKeyDown(key: Key): boolean {\n    return this.keysDown.has(key);\n  }\n  static wasKeyPressed(key: Key): boolean {\n    return this.keysPressed.has(key);\n  }\n  static wasKeyReleased(key: Key): boolean {\n    return this.keysReleased.has(key);\n  }\n}\n","// src/main.ts\nimport { GLContext } from \"./gl/GLContext.ts\";\nimport { Engine } from \"./core/Engine.ts\";\nimport { Shader } from \"./gl/Shader.ts\";\nimport { mat4, vec3 } from \"gl-matrix\";\nimport { Input } from \"./core/Input.ts\";\n\n// Touch Screen Controller Class\nclass TouchController {\n  private canvas: HTMLCanvasElement;\n  private jumpButton: HTMLButtonElement;\n  private interactButton: HTMLButtonElement;\n  private upButton: HTMLButtonElement;\n  private downButton: HTMLButtonElement;\n  private leftButton: HTMLButtonElement;\n  private rightButton: HTMLButtonElement;\n\n  private activeDirections = {\n    up: false,\n    down: false,\n    left: false,\n    right: false,\n  };\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n\n    // Create directional buttons\n    this.upButton = this.createButton(\"\", \"9rem\", \"4rem\", \"none\");\n    this.downButton = this.createButton(\"\", \"3rem\", \"4rem\", \"none\");\n    this.leftButton = this.createButton(\"\", \"6rem\", \"1rem\", \"none\");\n    this.rightButton = this.createButton(\"\", \"6rem\", \"7rem\", \"none\");\n\n    // Create jump button\n    this.jumpButton = document.createElement(\"button\");\n    this.jumpButton.textContent = \"\";\n    this.jumpButton.style.cssText = `\n      position: fixed;\n      bottom: 6rem;\n      right: 2rem;\n      width: 70px;\n      height: 70px;\n      font-size: 32px;\n      border-radius: 50%;\n      border: 2px solid rgba(255,255,255,0.3);\n      background: rgba(100,100,100,0.7);\n      color: white;\n      z-index: 1000;\n      touch-action: none;\n    `;\n    document.body.appendChild(this.jumpButton);\n\n    // Create interact button\n    this.interactButton = document.createElement(\"button\");\n    this.interactButton.textContent = \"E\";\n    this.interactButton.style.cssText = `\n      position: fixed;\n      bottom: 6rem;\n      right: 6rem;\n      width: 70px;\n      height: 70px;\n      font-size: 24px;\n      border-radius: 50%;\n      border: 2px solid rgba(255,255,255,0.3);\n      background: rgba(100,100,200,0.7);\n      color: white;\n      z-index: 1000;\n      touch-action: none;\n    `;\n    document.body.appendChild(this.interactButton);\n\n    this.setupListeners();\n  }\n\n  private createButton(\n    text: string,\n    bottom: string,\n    left: string,\n    transform: string,\n  ): HTMLButtonElement {\n    const button = document.createElement(\"button\");\n    button.textContent = text;\n    button.style.cssText = `\n      position: fixed;\n      bottom: ${bottom};\n      left: ${left};\n      transform: ${transform};\n      width: 60px;\n      height: 60px;\n      font-size: 28px;\n      border-radius: 50%;\n      border: 2px solid rgba(255,255,255,0.3);\n      background: rgba(100,100,100,0.7);\n      color: white;\n      z-index: 1000;\n      touch-action: none;\n    `;\n    document.body.appendChild(button);\n    return button;\n  }\n\n  private setupListeners() {\n    // Directional buttons\n    this.setupDirectionButton(this.upButton, \"up\");\n    this.setupDirectionButton(this.downButton, \"down\");\n    this.setupDirectionButton(this.leftButton, \"left\");\n    this.setupDirectionButton(this.rightButton, \"right\");\n\n    // Jump button\n    this.jumpButton.addEventListener(\"touchstart\", (e) => {\n      e.preventDefault();\n      Input.simulateKeyPress(\"Space\");\n    });\n\n    // Interact button\n    this.interactButton.addEventListener(\"touchstart\", (e) => {\n      e.preventDefault();\n      Input.simulateKeyPress(\"KeyE\");\n    });\n  }\n\n  private setupDirectionButton(\n    button: HTMLButtonElement,\n    direction: \"up\" | \"down\" | \"left\" | \"right\",\n  ) {\n    button.addEventListener(\"touchstart\", (e) => {\n      e.preventDefault();\n      this.activeDirections[direction] = true;\n    });\n\n    button.addEventListener(\"touchend\", (e) => {\n      e.preventDefault();\n      this.activeDirections[direction] = false;\n    });\n\n    button.addEventListener(\"touchcancel\", (e) => {\n      e.preventDefault();\n      this.activeDirections[direction] = false;\n    });\n  }\n\n  getMovementVector(): { x: number; z: number } {\n    let x = 0;\n    let z = 0;\n\n    if (this.activeDirections.up) z -= 1;\n    if (this.activeDirections.down) z += 1;\n    if (this.activeDirections.left) x -= 1;\n    if (this.activeDirections.right) x += 1;\n\n    // Normalize diagonal movement\n    if (x !== 0 && z !== 0) {\n      const length = Math.sqrt(x * x + z * z);\n      x /= length;\n      z /= length;\n    }\n\n    return { x, z };\n  }\n\n  updateButtonTheme(theme: Theme) {\n    const bgColor =\n      theme === \"dark\" ? \"rgba(100,100,100,0.7)\" : \"rgba(150,150,150,0.7)\";\n    this.jumpButton.style.background = bgColor;\n    this.upButton.style.background = bgColor;\n    this.downButton.style.background = bgColor;\n    this.leftButton.style.background = bgColor;\n    this.rightButton.style.background = bgColor;\n\n    const interactBg =\n      theme === \"dark\" ? \"rgba(100,100,200,0.7)\" : \"rgba(120,120,220,0.7)\";\n    this.interactButton.style.background = interactBg;\n  }\n}\n\n// OIMO Setup\ndeclare const OIMO: {\n  World: new (config: {\n    timestep: number;\n    iterations: number;\n    broadphase: number;\n    worldscale: number;\n    random: boolean;\n    info: boolean;\n    gravity: [number, number, number];\n  }) => OIMOWorld;\n};\n\ninterface OIMOWorld {\n  addRigidBody(body: OIMOBody): void;\n  step(): void;\n}\n\ninterface OIMOPhysicsWorld {\n  add(config: unknown): OIMOBody;\n}\n\ninterface OIMOBody {\n  getLinearVelocity?(): { x: number; y: number; z: number };\n  setLinearVelocity?(v: { x: number; y: number; z: number }): void;\n  getPosition(): { x: number; y: number; z: number };\n  setPosition?(v: { x: number; y: number; z: number }): void;\n  linearVelocity: { x: number; y: number; z: number }; // fallback\n}\n\n// ======================\n// Language (i18n + l10n) Handler\n// =====================\nconst button = document.createElement(\"button\");\nbutton.id = \"langBtn\";\nbutton.textContent = \"Language\";\ndocument.body.appendChild(button);\n\n// Basic layout/styling that doesn't depend on theme\nbutton.style.position = \"fixed\";\nbutton.style.top = \"1rem\";\nbutton.style.left = \"1rem\";\nbutton.style.padding = \"0.4rem 0.8rem\";\nbutton.style.borderRadius = \"0.4rem\";\nbutton.style.border = \"none\";\nbutton.style.cursor = \"pointer\";\nbutton.style.fontFamily = \"system-ui, sans-serif\";\nbutton.style.zIndex = \"10\";\n\n// Theme-aware styling\nfunction applyButtonTheme(theme: Theme) {\n  if (theme === \"dark\") {\n    button.style.backgroundColor = \"#222222dd\";\n    button.style.color = \"#f5f5f5\";\n    button.style.boxShadow = \"0 0 8px rgba(0, 0, 0, 0.7)\";\n  } else {\n    button.style.backgroundColor = \"#ffffffdd\";\n    button.style.color = \"#111111\";\n    button.style.boxShadow = \"0 0 8px rgba(0, 0, 0, 0.15)\";\n  }\n}\n\nlet currentButtonTheme: Theme = getPreferredTheme();\napplyButtonTheme(currentButtonTheme);\n\nlet touchController: TouchController | null = null;\n\n// React to OS/browser theme changes\nif (window.matchMedia) {\n  const mq = window.matchMedia(\"(prefers-color-scheme: dark)\");\n\n  const handleThemeChange = (ev: MediaQueryListEvent | MediaQueryList) => {\n    currentButtonTheme = ev.matches ? \"dark\" : \"light\";\n    applyButtonTheme(currentButtonTheme);\n    if (touchController) {\n      touchController.updateButtonTheme(currentButtonTheme);\n    }\n  };\n\n  // sync and listen\n  handleThemeChange(mq);\n  if (mq.addEventListener) {\n    mq.addEventListener(\n      \"change\",\n      handleThemeChange as (e: MediaQueryListEvent) => void,\n    );\n  } else {\n    // older browsers\n    mq.addListener(handleThemeChange as (e: MediaQueryListEvent) => void);\n  }\n}\n\nconst translations = {\n  en: {\n    button: \"Language\",\n    interact: \"Press 'E' to interact\",\n    doorNeedKey: \"You need a {color} key\",\n    doorOpen: \"Opened {color} door\",\n    winMessage: \"You Win!\",\n    keyPickup: \"Picked up {color} key\",\n  },\n  zh: {\n    button: \"\",\n    interact: \" 'E' \",\n    doorNeedKey: \"{color}\",\n    doorOpen: \"{color}\",\n    winMessage: \"\",\n    keyPickup: \"{color}\",\n  },\n  ar: {\n    button: \"\",\n    interact: \" 'E' \",\n    doorNeedKey: \"   {color}\",\n    doorOpen: \"   {color}\",\n    winMessage: \" !\",\n    keyPickup: \"  {color}\",\n  },\n};\n\nfunction updateText(lang: string) {\n  const t = translations[lang as keyof typeof translations] || translations.en;\n  document.getElementById(\"langBtn\")!.textContent = t.button;\n}\n\n// Language change button\ndocument.getElementById(\"langBtn\")!.addEventListener(\"click\", () => {\n  const html = document.documentElement;\n  if (html.lang === \"en\") {\n    html.lang = \"zh\";\n  } else if (html.lang === \"zh\") {\n    html.lang = \"ar\";\n    html.dir = \"rtl\";\n  } else {\n    html.lang = \"en\";\n    html.dir = \"ltr\";\n  }\n  updateText(html.lang);\n});\n\n// =======================\n// Shader sources\n// =======================\nconst VERT_SRC = `#version 300 es\nlayout(location = 0) in vec3 aPosition;\nlayout(location = 1) in vec3 aColor;\n\nuniform mat4 uMVP;\n\nout vec3 vColor;\n\nvoid main() {\n  vColor = aColor;\n  gl_Position = uMVP * vec4(aPosition, 1.0);\n}\n`;\n\nconst FRAG_SRC = `#version 300 es\nprecision highp float;\n\nin vec3 vColor;\nout vec4 outColor;\n\nuniform vec3 uAmbientColor;\n\nvoid main() {\n  // Simple \"lighting\": base color modulated by ambient theme color\n  vec3 litColor = vColor * uAmbientColor;\n  outColor = vec4(litColor, 1.0);\n}\n`;\n\n// =======================\n// Basic rendering types\n// =======================\ninterface Drawable {\n  vao: WebGLVertexArrayObject | null;\n  indexCount: number;\n  mode: number;\n}\n\n// Transform = position/rotation/scale + cached matrix\ninterface Transform {\n  position: vec3;\n  rotation: vec3; // Euler radians [x,y,z]\n  scale: vec3;\n  matrix: mat4;\n}\n\ninterface Renderable {\n  drawable: Drawable;\n}\n\ninterface PhysicsBody {\n  body: OIMOBody;\n}\n\ninterface Platform {\n  topY: number; // top surface height in world space\n}\n\n// Objects with proximity triggers\ninterface ProximityTrigger {\n  triggerRadius: number;\n}\n\ninterface Interactable extends ProximityTrigger {\n  onInteract(): void;\n}\n\ninterface Collectible extends ProximityTrigger {\n  id: string;\n  isCollected: boolean;\n}\n\ntype KeyColor = \"\" | \"\";\ninterface Key extends Interactable {\n  color: KeyColor;\n  collect(): void;\n}\n\ntype DoorColor = \"\" | \"\";\ninterface Door extends Interactable {\n  color: DoorColor;\n  isOpen: boolean;\n  open(): void;\n}\n\ninterface WinCondition extends ProximityTrigger {\n  completed: boolean;\n}\n\n// Persistent Global State\ninterface GlobalKeyState {\n  color: KeyColor;\n  collected: boolean;\n}\n\ninterface GlobalDoorState {\n  color: DoorColor;\n  isOpen: boolean;\n}\n\nconst globalState = {\n  inventory: {\n    held: null as KeyColor | null,\n  },\n  keys: new Map<string, GlobalKeyState>(),\n  doors: new Map<string, GlobalDoorState>(),\n};\n\ninterface SaveGameV1 {\n  version: 1;\n  sceneIndex: number;\n  playerPos: [number, number, number];\n  inventoryHeld: KeyColor | null;\n  keys: Record<string, GlobalKeyState>;\n  doors: Record<string, GlobalDoorState>;\n  collectibles: Record<string, boolean>;\n}\n\nconst globalCollectibles = new Map<string, boolean>();\n\n// Persistent Inventory\nconst inventory: { held: KeyColor | null } = {\n  held: null,\n};\n\n// Light and Dark Theme Types\ntype Theme = \"light\" | \"dark\";\n\nfunction getPreferredTheme(): Theme {\n  if (\n    globalThis.matchMedia &&\n    globalThis.matchMedia(\"(prefers-color-scheme: dark)\").matches\n  ) {\n    return \"dark\";\n  }\n  return \"light\";\n}\n\n// =======================\n// ECS Registry\n// =======================\ntype Entity = number;\n\nclass ECS {\n  private nextEntity: number = 1;\n\n  transforms = new Map<Entity, Transform>();\n  renderables = new Map<Entity, Renderable>();\n  physicsBodies = new Map<Entity, PhysicsBody>();\n  collectibles = new Map<Entity, Collectible>();\n  interactables = new Map<Entity, Interactable>();\n  winConditions = new Map<Entity, WinCondition>();\n  platforms = new Map<Entity, Platform>();\n  players = new Set<Entity>(); // tags\n\n  createEntity(): Entity {\n    return this.nextEntity++;\n  }\n}\n\n// =======================\n// Scene config\n// =======================\ninterface PlatformConfig {\n  pos: [number, number, number];\n  size: [number, number, number];\n}\n\ninterface SceneConfig {\n  playerStart: [number, number, number];\n  winconPos: [number, number, number];\n  collectibles: [number, number, number][];\n  platforms: PlatformConfig[];\n  keys?: { id: string; color: KeyColor; pos: [number, number, number] }[];\n  doors?: {\n    id: string;\n    color: DoorColor;\n    pos: [number, number, number];\n    size: [number, number, number];\n  }[];\n}\n\n// Example scene (we can make more later)\nconst testScene: SceneConfig = {\n  playerStart: [0, 0.5, 0],\n  winconPos: [0, 7.5, -1],\n  collectibles: [\n    [0, 3.5, -3],\n    [0, 1.5, 3],\n    [0, 5.5, -8],\n  ],\n  platforms: [\n    { pos: [0, 3.0, -3], size: [3, 0.5, 3] },\n    { pos: [0, 1.0, 3], size: [3, 0.5, 3] },\n    { pos: [0, 5.0, -8], size: [3, 0.5, 3] },\n    { pos: [0, 7.0, -1], size: [3, 0.5, 3] },\n  ],\n  keys: [\n    { id: \"keyRed1\", color: \"\", pos: [2, 1, -5] },\n    { id: \"keyBlue1\", color: \"\", pos: [-2, 1, -5] },\n  ],\n\n  doors: [],\n};\n\nconst scene2: SceneConfig = {\n  playerStart: [0, 0.5, 0],\n  winconPos: [0, 9.5, -12],\n  collectibles: [\n    [4, 2.5, -2],\n    [-4, 4.5, -5],\n    [3, 6.5, -9],\n    [-3, 8.5, -11],\n  ],\n  platforms: [\n    { pos: [1, 2.0, -2], size: [4, 0.5, 4] },\n    { pos: [-4, 4.0, -5], size: [3, 0.5, 3] },\n    { pos: [3, 5.0, -9], size: [4, 0.5, 4] },\n    { pos: [-3, 7.0, -10], size: [3, 0.5, 3] },\n    { pos: [0, 9.0, -12], size: [3, 0.5, 3] },\n  ],\n  keys: [],\n  doors: [\n    { id: \"doorRed1\", color: \"\", pos: [-0.7, 4.5, -2], size: [0.5, 5, 3.9] },\n  ],\n};\n\n// =======================\n// Helpers\n// =======================\n\n// Build VAO from positions/colors/indices\nfunction createDrawable(\n  gl: WebGL2RenderingContext,\n  positions: number[],\n  colors: number[],\n  indices: number[],\n  mode: number,\n): Drawable {\n  const vao = gl.createVertexArray();\n  if (!vao) throw new Error(\"Failed to create VAO\");\n\n  gl.bindVertexArray(vao);\n\n  const vertexCount = positions.length / 3;\n  const stride = 6; // 3 pos + 3 color\n  const vertexData = new Float32Array(vertexCount * stride);\n\n  for (let i = 0; i < vertexCount; i++) {\n    vertexData[i * stride + 0] = positions[i * 3 + 0];\n    vertexData[i * stride + 1] = positions[i * 3 + 1];\n    vertexData[i * stride + 2] = positions[i * 3 + 2];\n\n    vertexData[i * stride + 3] = colors[i * 3 + 0];\n    vertexData[i * stride + 4] = colors[i * 3 + 1];\n    vertexData[i * stride + 5] = colors[i * 3 + 2];\n  }\n\n  const vbo = gl.createBuffer();\n  if (!vbo) throw new Error(\"Failed to create VBO\");\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n  gl.bufferData(gl.ARRAY_BUFFER, vertexData, gl.STATIC_DRAW);\n\n  const ibo = gl.createBuffer();\n  if (!ibo) throw new Error(\"Failed to create IBO\");\n\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);\n  gl.bufferData(\n    gl.ELEMENT_ARRAY_BUFFER,\n    new Uint16Array(indices),\n    gl.STATIC_DRAW,\n  );\n\n  const strideBytes = stride * 4;\n\n  // aPosition\n  gl.enableVertexAttribArray(0);\n  gl.vertexAttribPointer(0, 3, gl.FLOAT, false, strideBytes, 0);\n\n  // aColor\n  gl.enableVertexAttribArray(1);\n  gl.vertexAttribPointer(1, 3, gl.FLOAT, false, strideBytes, 3 * 4);\n\n  gl.bindVertexArray(null);\n  gl.bindBuffer(gl.ARRAY_BUFFER, null);\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n  return {\n    vao,\n    indexCount: indices.length,\n    mode,\n  };\n}\n\n// Create an Oimo box body\nfunction createBoxBody(opts: {\n  world: OIMOPhysicsWorld;\n  size: [number, number, number];\n  pos: [number, number, number];\n  move: boolean;\n  density?: number;\n}) {\n  const { world, size, pos, move, density = 1 } = opts;\n  return world.add({\n    type: \"box\",\n    size,\n    pos,\n    rot: [0, 0, 0],\n    move,\n    density,\n  });\n}\n\n// Update transform.matrix from position/rotation/scale\nfunction updateTransformMatrix(t: Transform) {\n  const m = t.matrix;\n  mat4.identity(m);\n  mat4.translate(m, m, t.position);\n  mat4.rotateX(m, m, t.rotation[0]);\n  mat4.rotateY(m, m, t.rotation[1]);\n  mat4.rotateZ(m, m, t.rotation[2]);\n  mat4.scale(m, m, t.scale);\n}\n\nfunction onInteract(obj: Key | Door) {\n  const t =\n    translations[document.documentElement.lang as keyof typeof translations] ||\n    translations.en;\n\n  if (\"collect\" in obj) {\n    // Key\n    obj.collect();\n    inventory.held = obj.color;\n    showUIMessage(t.keyPickup.replace(\"{color}\", obj.color), 1.5);\n  } else if (\"open\" in obj) {\n    // Door\n    if (inventory.held === obj.color) {\n      showUIMessage(t.doorOpen.replace(\"{color}\", obj.color), 1.5);\n      obj.isOpen = true;\n    } else {\n      showUIMessage(t.doorNeedKey.replace(\"{color}\", obj.color), 1.5);\n    }\n  }\n}\n\n// =======================\n// Scene building\n// =======================\ninterface SharedMeshes {\n  playerCube: Drawable;\n  collectibleCube: Drawable;\n  platformCube: Drawable;\n  winPyramid: Drawable;\n  floorGrid: Drawable;\n  keyRedTriangle: Drawable;\n  keyBlueTriangle: Drawable;\n  doorRedCube: Drawable;\n  doorBlueCube: Drawable;\n}\n\ninterface SceneBuildResult {\n  playerEntity: Entity;\n}\n\nfunction buildScene(\n  _gl: WebGL2RenderingContext,\n  world: OIMOPhysicsWorld,\n  ecs: ECS,\n  meshes: SharedMeshes,\n  config: SceneConfig,\n  gridSize: number,\n  sceneIndex: number,\n): SceneBuildResult {\n  // ----- Player -----\n  const playerE = ecs.createEntity();\n\n  const playerTransform: Transform = {\n    position: vec3.fromValues(\n      config.playerStart[0],\n      config.playerStart[1],\n      config.playerStart[2],\n    ),\n    rotation: vec3.fromValues(0, 0, 0),\n    scale: vec3.fromValues(1, 1, 1),\n    matrix: mat4.create(),\n  };\n  updateTransformMatrix(playerTransform);\n\n  ecs.transforms.set(playerE, playerTransform);\n  ecs.renderables.set(playerE, { drawable: meshes.playerCube });\n\n  const playerBody = createBoxBody({\n    world,\n    size: [1, 1, 1],\n    pos: config.playerStart,\n    move: true,\n    density: 1,\n  });\n  ecs.physicsBodies.set(playerE, { body: playerBody });\n  ecs.players.add(playerE);\n\n  // ----- Floor (grid render + static platform physics) -----\n  const floorE = ecs.createEntity();\n  const floorTransform: Transform = {\n    position: vec3.fromValues(0, 0, 0),\n    rotation: vec3.fromValues(0, 0, 0),\n    scale: vec3.fromValues(1, 1, 1),\n    matrix: mat4.create(),\n  };\n  updateTransformMatrix(floorTransform);\n\n  ecs.transforms.set(floorE, floorTransform);\n  ecs.renderables.set(floorE, { drawable: meshes.floorGrid });\n\n  const floorBody = createBoxBody({\n    world,\n    size: [gridSize * 2, 1, gridSize * 2],\n    pos: [0, -0.5, 0],\n    move: false,\n  });\n  ecs.physicsBodies.set(floorE, { body: floorBody });\n  ecs.platforms.set(floorE, { topY: 0 }); // top of floor at y = 0\n\n  // ----- Win condition -----\n  const winE = ecs.createEntity();\n  const winTransform: Transform = {\n    position: vec3.fromValues(\n      config.winconPos[0],\n      config.winconPos[1],\n      config.winconPos[2],\n    ),\n    rotation: vec3.fromValues(0, 0, 0),\n    scale: vec3.fromValues(1, 1, 1),\n    matrix: mat4.create(),\n  };\n  updateTransformMatrix(winTransform);\n\n  ecs.transforms.set(winE, winTransform);\n  ecs.renderables.set(winE, { drawable: meshes.winPyramid });\n  ecs.winConditions.set(winE, { completed: false, triggerRadius: 1.0 });\n\n  // ----- Collectibles -----\n  config.collectibles.forEach((pos, index) => {\n    const collectibleId = `scene${sceneIndex}_c${index}`;\n\n    // If we've already collected this in a previous session, skip spawning it\n    if (globalCollectibles.get(collectibleId)) {\n      return;\n    }\n\n    // Ensure default state exists\n    if (!globalCollectibles.has(collectibleId)) {\n      globalCollectibles.set(collectibleId, false);\n    }\n\n    const cE = ecs.createEntity();\n    const t: Transform = {\n      position: vec3.fromValues(pos[0], pos[1], pos[2]),\n      rotation: vec3.fromValues(0, 0, 0),\n      scale: vec3.fromValues(1, 1, 1),\n      matrix: mat4.create(),\n    };\n    updateTransformMatrix(t);\n\n    ecs.transforms.set(cE, t);\n    ecs.renderables.set(cE, { drawable: meshes.collectibleCube });\n\n    ecs.collectibles.set(cE, {\n      id: collectibleId,\n      isCollected: false,\n      triggerRadius: 1.0,\n    });\n  });\n\n\n  // ----- Keys -----\n  for (const keyData of config.keys ?? []) {\n    if (!globalState.keys.has(keyData.id)) {\n      globalState.keys.set(keyData.id, {\n        color: keyData.color,\n        collected: false,\n      });\n    }\n\n    const keyState = globalState.keys.get(keyData.id)!;\n    if (keyState.collected) continue;\n\n    const keyE = ecs.createEntity();\n    const t: Transform = {\n      position: vec3.fromValues(...keyData.pos),\n      rotation: vec3.fromValues(0, 0, 0),\n      scale: vec3.fromValues(1, 1, 1),\n      matrix: mat4.create(),\n    };\n    updateTransformMatrix(t);\n\n    ecs.transforms.set(keyE, t);\n    const keyDrawable =\n      keyState.color === \"\" ? meshes.keyRedTriangle : meshes.keyBlueTriangle;\n    ecs.renderables.set(keyE, { drawable: keyDrawable });\n\n    ecs.interactables.set(keyE, {\n      triggerRadius: 1.0,\n      color: keyState.color,\n      collect() {\n        keyState.collected = true;\n        globalState.inventory.held = keyState.color;\n        const t =\n          translations[\n            document.documentElement.lang as keyof typeof translations\n          ] || translations.en;\n        showUIMessage(t.keyPickup.replace(\"{color}\", keyState.color), 1.5);\n        ecs.renderables.delete(keyE);\n        ecs.interactables.delete(keyE);\n      },\n      onInteract() {\n        onInteract(this);\n      },\n    } as Key);\n  }\n\n  // ----- Doors -----\n  for (const doorData of config.doors ?? []) {\n    if (!globalState.doors.has(doorData.id)) {\n      globalState.doors.set(doorData.id, {\n        color: doorData.color,\n        isOpen: false,\n      });\n    }\n\n    const doorState = globalState.doors.get(doorData.id)!;\n    if (doorState.isOpen) continue;\n\n    const doorE = ecs.createEntity();\n    const t: Transform = {\n      position: vec3.fromValues(...doorData.pos),\n      rotation: vec3.fromValues(0, 0, 0),\n      scale: vec3.fromValues(...doorData.size),\n      matrix: mat4.create(),\n    };\n    updateTransformMatrix(t);\n\n    ecs.transforms.set(doorE, t);\n    const doorDrawable =\n      doorState.color === \"\" ? meshes.doorRedCube : meshes.doorBlueCube;\n    ecs.renderables.set(doorE, { drawable: doorDrawable });\n\n    // --- Add physics ---\n    const doorBody = createBoxBody({\n      world,\n      size: doorData.size,\n      pos: doorData.pos,\n      move: false, // static\n    });\n    ecs.physicsBodies.set(doorE, { body: doorBody });\n\n    ecs.interactables.set(doorE, {\n      triggerRadius: 2.0,\n      color: doorState.color,\n      isOpen: doorState.isOpen,\n      open() {\n        doorState.isOpen = true;\n        const t =\n          translations[\n            document.documentElement.lang as keyof typeof translations\n          ] || translations.en;\n        showUIMessage(t.doorOpen.replace(\"{color}\", doorState.color), 1.5);\n\n        // Remove door from ECS\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (world as any).removeRigidBody(doorBody);\n        ecs.renderables.delete(doorE);\n        ecs.physicsBodies.delete(doorE);\n        ecs.interactables.delete(doorE);\n      },\n      onInteract() {\n        const t =\n          translations[\n            document.documentElement.lang as keyof typeof translations\n          ] || translations.en;\n\n        if (inventory.held === this.color && !this.isOpen) {\n          this.open();\n        } else if (inventory.held !== this.color) {\n          showUIMessage(t.doorNeedKey.replace(\"{color}\", this.color), 1.5);\n        }\n      },\n    } as Door);\n  }\n\n  // ----- Raised Platforms -----\n  for (const platform of config.platforms) {\n    const [px, py, pz] = platform.pos;\n    const [sx, sy, sz] = platform.size;\n\n    const pE = ecs.createEntity();\n    const t: Transform = {\n      position: vec3.fromValues(px, py, pz),\n      rotation: vec3.fromValues(0, 0, 0),\n      scale: vec3.fromValues(sx, sy, sz),\n      matrix: mat4.create(),\n    };\n    updateTransformMatrix(t);\n\n    ecs.transforms.set(pE, t);\n    ecs.renderables.set(pE, { drawable: meshes.platformCube });\n\n    const body = createBoxBody({\n      world,\n      size: [sx, sy, sz],\n      pos: [px, py, pz],\n      move: false,\n    });\n    ecs.physicsBodies.set(pE, { body });\n\n    const topY = py + sy / 2;\n    ecs.platforms.set(pE, { topY });\n  }\n\n  return { playerEntity: playerE };\n}\n\nlet uiMessage: string | null = null;\nlet uiTimer = 0;\nfunction showUIMessage(msg: string, duration = 0.5) {\n  uiMessage = msg;\n  uiTimer = duration;\n}\n\n// =======================\n// Main bootstrap\n// =======================\nfunction bootstrap() {\n  Input.init();\n  const canvas = document.getElementById(\"game\") as HTMLCanvasElement | null;\n  if (!canvas) {\n    throw new Error(\"Canvas element with id 'game' not found\");\n  }\n\n  // Prevent default touch behaviors on canvas\n  canvas.style.touchAction = \"none\";\n  canvas.style.userSelect = \"none\";\n\n  touchController = new TouchController(canvas);\n  const uiCanvas = document.getElementById(\"ui\") as HTMLCanvasElement;\n  const uiCtx = uiCanvas.getContext(\"2d\")!;\n  \n  // Save the current game state key\n  const SAVE_KEY = \"platform_oimo_save_v1\";\n\n  // Save the current game state to localStorage\n  function saveGame() {\n    const playerPhys = ecs.physicsBodies.get(playerEntity);\n    const playerTransform = ecs.transforms.get(playerEntity);\n    if (!playerPhys || !playerTransform) return;\n\n    const body = playerPhys.body;\n    const vel =\n      typeof body.getLinearVelocity === \"function\"\n        ? body.getLinearVelocity()\n        : body.linearVelocity;\n\n    const save: SaveGameV1 = {\n      version: 1,\n      sceneIndex: currentSceneIndex,\n      playerPos: [\n        playerTransform.position[0],\n        playerTransform.position[1],\n        playerTransform.position[2],\n      ],\n      inventoryHeld: inventory.held,\n      keys: {},\n      doors: {},\n      collectibles: {},\n    };\n\n    for (const [id, state] of globalState.keys) {\n      save.keys[id] = { ...state };\n    }\n    for (const [id, state] of globalState.doors) {\n      save.doors[id] = { ...state };\n    }\n    for (const [id, collected] of globalCollectibles) {\n      save.collectibles[id] = collected;\n    }\n\n    localStorage.setItem(SAVE_KEY, JSON.stringify(save));\n    showUIMessage(\"Game saved\", 1.0);\n  }\n\n  // Load the game state from localStorage\n  function loadGame() {\n    const raw = localStorage.getItem(SAVE_KEY);\n    if (!raw) {\n      showUIMessage(\"No save found\", 1.0);\n      return;\n    }\n\n    let data: SaveGameV1;\n    try {\n      data = JSON.parse(raw) as SaveGameV1;\n    } catch (e) {\n      console.error(\"Failed to parse save data\", e);\n      showUIMessage(\"Save data corrupted\", 1.0);\n      return;\n    }\n\n    if (data.version !== 1) {\n      showUIMessage(\"Save version mismatch\", 1.0);\n      return;\n    }\n\n    // Restore global & inventory state BEFORE rebuilding the scene\n    inventory.held = data.inventoryHeld;\n    globalState.inventory.held = data.inventoryHeld;\n\n    globalState.keys.clear();\n    for (const id in data.keys) {\n      globalState.keys.set(id, data.keys[id]);\n    }\n\n    globalState.doors.clear();\n    for (const id in data.doors) {\n      globalState.doors.set(id, data.doors[id]);\n    }\n\n    globalCollectibles.clear();\n    for (const id in data.collectibles) {\n      globalCollectibles.set(id, data.collectibles[id]);\n    }\n\n    // Restore scene\n    currentSceneIndex = data.sceneIndex;\n    world = loadScene(currentSceneIndex);\n\n    // Reposition player\n    const playerPhys = ecs.physicsBodies.get(playerEntity);\n    const playerTransform = ecs.transforms.get(playerEntity);\n    if (playerPhys && playerTransform) {\n      const [px, py, pz] = data.playerPos;\n      vec3.set(playerTransform.position, px, py, pz);\n      updateTransformMatrix(playerTransform);\n\n      const body = playerPhys.body;\n      const p = body.getPosition();\n      p.x = px;\n      p.y = py;\n      p.z = pz;\n    }\n    showUIMessage(\"Game loaded\", 1.0);\n  }\n\n// Start a completely new game\nfunction newGame() {\n  localStorage.removeItem(SAVE_KEY);\n\n  inventory.held = null;\n  globalState.inventory.held = null;\n\n  globalState.keys.clear();\n  globalState.doors.clear();\n  globalCollectibles.clear();\n\n  currentSceneIndex = 0;\n  world = loadScene(currentSceneIndex);\n\n  showUIMessage(\"New game\", 1.0);\n}\n\n\n\n  function renderUI(dt: number) {\n    uiCtx.clearRect(0, 0, uiCanvas.width, uiCanvas.height);\n    if (uiMessage) {\n      uiCtx.font = \"20px Arial\";\n      uiCtx.fillStyle = uiTextColor;\n      uiCtx.textAlign = \"center\";\n      uiCtx.fillText(uiMessage, uiCanvas.width / 2, uiCanvas.height - 50);\n      uiTimer -= dt;\n      if (uiTimer <= 0) {\n        uiMessage = null;\n      }\n    }\n  }\n\n  const glctx = new GLContext(canvas);\n  const gl = glctx.gl;\n\n  const shader = new Shader(gl, VERT_SRC, FRAG_SRC);\n  const uMVP = shader.getUniformLocation(\"uMVP\");\n  if (!uMVP) throw new Error(\"Failed to get uMVP uniform\");\n  const uAmbientColor = shader.getUniformLocation(\"uAmbientColor\");\n  if (!uAmbientColor) throw new Error(\"Failed to get uAmbientColor uniform\");\n\n  // === Theme & Lighting Setup =====\n  let currentTheme: Theme = getPreferredTheme();\n\n  function getAmbientThemeColor(theme: Theme): [number, number, number] {\n    return theme === \"dark\"\n      ? [0.6, 0.6, 0.7] // Dark theme\n      : [1.0, 1.0, 1.0]; // Light theme\n  }\n\n  function getClearThemeColor(theme: Theme): [number, number, number, number] {\n    return theme === \"dark\"\n      ? [0.1, 0.1, 0.15, 1.0] // Dark theme\n      : [0.9, 0.9, 1.0, 1.0]; // Light theme\n  }\n\n  function getUIForegroundColor(theme: Theme): string {\n    return theme === \"dark\"\n      ? \"#ffffff\" // Dark theme\n      : \"#111111\"; // Light theme\n  }\n\n  let uiTextColor = getUIForegroundColor(currentTheme);\n\n  // React to system theme changes in real-time\n  if (globalThis.matchMedia) {\n    const mq = globalThis.matchMedia(\"(prefers-color-scheme: dark)\");\n    const themeChangeHandler = (e: MediaQueryListEvent) => {\n      currentTheme = e.matches ? \"dark\" : \"light\";\n      uiTextColor = getUIForegroundColor(currentTheme);\n    };\n\n    // Initial sync\n    themeChangeHandler(mq as unknown as MediaQueryListEvent);\n\n    // Listen for changes\n    mq.addEventListener(\"change\", themeChangeHandler);\n  }\n\n  function clearWithTheme() {\n    const [r, g, b, a] = getClearThemeColor(currentTheme);\n    gl.clearColor(r, g, b, a);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n  }\n\n  // ---------- Physics World ----------\n  let world = new OIMO.World({\n    timestep: 1 / 60,\n    iterations: 8,\n    broadphase: 2,\n    worldscale: 1,\n    random: true,\n    info: false,\n    gravity: [0, -9.8, 0],\n  });\n\n  const ecs = new ECS();\n  let currentSceneIndex = 0;\n  const scenes = [testScene, scene2];\n  let playerEntity: Entity;\n\n  // ---------- Shared Geometry ----------\n  // Cube geometry shared by player/platforms/collectibles\n  const cubePositions = [\n    // front\n    -0.5, -0.5, 0.5, 0.5, -0.5, 0.5, 0.5, 0.5, 0.5, -0.5, 0.5, 0.5,\n    // back\n    -0.5, -0.5, -0.5, 0.5, -0.5, -0.5, 0.5, 0.5, -0.5, -0.5, 0.5, -0.5,\n  ];\n  const cubeIndices = [\n    0,\n    1,\n    2,\n    0,\n    2,\n    3, // front\n    1,\n    5,\n    6,\n    1,\n    6,\n    2, // right\n    5,\n    4,\n    7,\n    5,\n    7,\n    6, // back\n    4,\n    0,\n    3,\n    4,\n    3,\n    7, // left\n    3,\n    2,\n    6,\n    3,\n    6,\n    7, // top\n    4,\n    5,\n    1,\n    4,\n    1,\n    0, // bottom\n  ];\n\n  // Player colors\n  const playerCubeColors = [\n    // front (red-ish)\n    1, 0, 0, 1, 0.3, 0.3, 1, 0.3, 0.3, 1, 0, 0,\n    // back (orange-ish)\n    1, 0.6, 0.2, 1, 0.8, 0.3, 1, 0.8, 0.3, 1, 0.6, 0.2,\n  ];\n\n  // Collectible colors (cyan)\n  const collectibleCubeColors = [\n    // front\n    0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1,\n    // back\n    0, 0.8, 0.8, 0, 0.8, 0.8, 0, 0.8, 0.8, 0, 0.8, 0.8,\n  ];\n\n  // Interactables\n\n  const doorRedColors = [\n    // front\n    1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0,\n    // back\n    1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0,\n  ];\n\n  const doorRedCube = createDrawable(\n    gl,\n    cubePositions,\n    doorRedColors,\n    cubeIndices,\n    gl.TRIANGLES,\n  );\n\n  const doorBlueColors = [\n    // front\n    0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1,\n    // back\n    0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1,\n    // left\n    0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1,\n    // right\n    0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1,\n    // top\n    0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1,\n    // bottom\n    0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1,\n  ];\n\n  const doorBlueCube = createDrawable(\n    gl,\n    cubePositions,\n    doorBlueColors,\n    cubeIndices,\n    gl.TRIANGLES,\n  );\n\n  const keyPositions = [\n    // front\n    0, 0.5, 0, -0.5, -0.5, 0, 0.5, -0.5, 0,\n    // back\n    0, 0.5, -0.2, -0.5, -0.5, -0.2, 0.5, -0.5, -0.2,\n  ];\n\n  const keyIndices = [\n    0,\n    1,\n    2, // front\n    3,\n    5,\n    4, // back\n    0,\n    3,\n    1,\n    1,\n    3,\n    4, // side 1\n    1,\n    4,\n    2,\n    2,\n    4,\n    5, // side 2\n    2,\n    5,\n    0,\n    0,\n    5,\n    3, // side 3\n  ];\n\n  const keyRedColors = [\n    // front\n    1, 0, 0, 1, 0, 0, 1, 0, 0,\n    // back\n    1, 0, 0, 1, 0, 0, 1, 0, 0,\n  ];\n\n  const keyBlueColors = [\n    // front\n    0, 0, 1, 0, 0, 1, 0, 0, 1,\n    // back\n    0, 0, 1, 0, 0, 1, 0, 0, 1,\n  ];\n\n  const keyRedTriangle = createDrawable(\n    gl,\n    keyPositions,\n    keyRedColors,\n    keyIndices,\n    gl.TRIANGLES,\n  );\n\n  const keyBlueTriangle = createDrawable(\n    gl,\n    keyPositions,\n    keyBlueColors,\n    keyIndices,\n    gl.TRIANGLES,\n  );\n\n  // Platform colors (gray)\n  const platformCubeColors = [\n    // front\n    0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5,\n    // back\n    0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5,\n  ];\n\n  const playerCube = createDrawable(\n    gl,\n    cubePositions,\n    playerCubeColors,\n    cubeIndices,\n    gl.TRIANGLES,\n  );\n  const collectibleCube = createDrawable(\n    gl,\n    cubePositions,\n    collectibleCubeColors,\n    cubeIndices,\n    gl.TRIANGLES,\n  );\n  const platformCube = createDrawable(\n    gl,\n    cubePositions,\n    platformCubeColors,\n    cubeIndices,\n    gl.TRIANGLES,\n  );\n\n  // Win condition pyramid\n  const winconPositions = [\n    // base\n    -0.3, 0, -0.3, 0.3, 0, -0.3, 0.3, 0, 0.3, -0.3, 0, 0.3,\n    // apex\n    0, 0.6, 0,\n  ];\n  const winconColors = [\n    // base (yellow)\n    1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0,\n    // apex\n    1, 1, 0.5,\n  ];\n  const winconIndices = [\n    0,\n    1,\n    2,\n    0,\n    2,\n    3, // base\n    0,\n    4,\n    1,\n    1,\n    4,\n    2,\n    2,\n    4,\n    3,\n    3,\n    4,\n    0, // sides\n  ];\n  const winPyramid = createDrawable(\n    gl,\n    winconPositions,\n    winconColors,\n    winconIndices,\n    gl.TRIANGLES,\n  );\n\n  // Floor grid lines\n  const gridSize = 10;\n  const divisions = 20;\n  const floorY = 0;\n\n  const gridPositions: number[] = [];\n  const gridColors: number[] = [];\n  const gridIndices: number[] = [];\n\n  for (let i = 0; i <= divisions; i++) {\n    const t = -gridSize + (2 * gridSize * i) / divisions;\n    const baseIndex = gridPositions.length / 3;\n\n    // lines parallel to X\n    gridPositions.push(-gridSize, floorY, t, gridSize, floorY, t);\n    gridColors.push(0.8, 0.8, 0.8, 0.8, 0.8, 0.8);\n    gridIndices.push(baseIndex, baseIndex + 1);\n  }\n  for (let i = 0; i <= divisions; i++) {\n    const t = -gridSize + (2 * gridSize * i) / divisions;\n    const baseIndex = gridPositions.length / 3;\n\n    // lines parallel to Z\n    gridPositions.push(t, floorY, -gridSize, t, floorY, gridSize);\n    gridColors.push(0.8, 0.8, 0.8, 0.8, 0.8, 0.8);\n    gridIndices.push(baseIndex, baseIndex + 1);\n  }\n\n  const floorGrid = createDrawable(\n    gl,\n    gridPositions,\n    gridColors,\n    gridIndices,\n    gl.LINES,\n  );\n\n  const meshes: SharedMeshes = {\n    playerCube,\n    collectibleCube,\n    platformCube,\n    winPyramid,\n    floorGrid,\n    keyRedTriangle,\n    keyBlueTriangle,\n    doorRedCube,\n    doorBlueCube,\n  };\n\n  world = loadScene(currentSceneIndex);\n\n  function loadScene(sceneIndex: number) {\n    // Clear ECS\n    ecs.transforms.clear();\n    ecs.renderables.clear();\n    ecs.physicsBodies.clear();\n    ecs.collectibles.clear();\n    ecs.winConditions.clear();\n    ecs.platforms.clear();\n    ecs.players.clear();\n\n    // Reset physics world (recreate it)\n    const newWorld = new OIMO.World({\n      timestep: 1 / 60,\n      iterations: 8,\n      broadphase: 2,\n      worldscale: 1,\n      random: true,\n      info: false,\n      gravity: [0, -9.8, 0],\n    });\n\n    // Build the new scene\n    const result = buildScene(\n      gl,\n      newWorld as unknown as OIMOPhysicsWorld,\n      ecs,\n      meshes,\n      scenes[sceneIndex],\n      gridSize,\n      sceneIndex,\n    );\n\n    playerEntity = result.playerEntity;\n\n    return newWorld;\n  }\n\n  // =======================\n  // Camera setup\n  // =======================\n  const projection = mat4.create();\n  const view = mat4.create();\n  const vp = mat4.create();\n  const mvp = mat4.create();\n  const tmp = mat4.create();\n\n  const playerPos = vec3.create();\n\n  function updateCamera() {\n    const aspect = glctx.canvas.width / glctx.canvas.height;\n    mat4.perspective(projection, (80 * Math.PI) / 180, aspect, 0.1, 100.0);\n\n    const eye = vec3.fromValues(\n      playerPos[0] + 5,\n      playerPos[1] + 5,\n      playerPos[2] + 5,\n    );\n    const center = playerPos;\n    const up = vec3.fromValues(0, 1, 0);\n    mat4.lookAt(view, eye, center, up);\n\n    mat4.multiply(vp, projection, view);\n  }\n\n  // =======================\n  // Game loop (Engine)\n  // =======================\n  let physicsAccumulator = 0;\n  const fixedTimeStep = 1 / 60;\n  const moveSpeed = 5;\n  const jumpSpeed = 6.5;\n  const playerHalfHeight = 0.5;\n  let playerGrounded = false;\n\n  const engine = new Engine((dt: number) => {\n    clearWithTheme();\n\n    const playerPhys = ecs.physicsBodies.get(playerEntity);\n    if (!playerPhys) return;\n\n    // ---------- INPUT  Physics (movement & jump) ----------\n    const body = playerPhys.body;\n    const vel =\n      typeof body.getLinearVelocity === \"function\"\n        ? body.getLinearVelocity()\n        : body.linearVelocity;\n    const touchMovement = touchController?.getMovementVector() ?? {\n      x: 0,\n      z: 0,\n    };\n    let vx = 0;\n    let vz = 0;\n\n    if (Input.isKeyDown(\"ArrowUp\") || Input.isKeyDown(\"KeyW\")) vz -= moveSpeed;\n    if (Input.isKeyDown(\"ArrowDown\") || Input.isKeyDown(\"KeyS\")) {\n      vz += moveSpeed;\n    }\n    if (Input.isKeyDown(\"ArrowLeft\") || Input.isKeyDown(\"KeyA\")) {\n      vx -= moveSpeed;\n    }\n    if (Input.isKeyDown(\"ArrowRight\") || Input.isKeyDown(\"KeyD\")) {\n      vx += moveSpeed;\n    }\n\n    vx += touchMovement.x * moveSpeed;\n    vz += touchMovement.z * moveSpeed;\n\n    vel.x = vx;\n    vel.z = vz;\n\n    if (Input.wasKeyPressed(\"Space\") && playerGrounded) {\n      vel.y = jumpSpeed;\n    }\n\n    if (typeof body.setLinearVelocity === \"function\") {\n      body.setLinearVelocity(vel);\n    } else {\n      body.linearVelocity = vel;\n    }\n\n    // ---------- Fixed-step physics ----------\n    physicsAccumulator += dt;\n    while (physicsAccumulator >= fixedTimeStep) {\n      world.step();\n      physicsAccumulator -= fixedTimeStep;\n    }\n\n    // ---------- Sync transforms from physics ----------\n    for (const [e, phys] of ecs.physicsBodies) {\n      const t = ecs.transforms.get(e);\n      if (!t) continue;\n      const p = phys.body.getPosition();\n      vec3.set(t.position, p.x, p.y, p.z);\n      // keep rotation/scale as-is; just update position\n      updateTransformMatrix(t);\n    }\n\n    // ---------- Player world position ----------\n    const playerTransform = ecs.transforms.get(playerEntity);\n    if (playerTransform) {\n      vec3.copy(playerPos, playerTransform.position);\n    }\n\n    // ---------- Ground check (floor + platforms) ----------\n    playerGrounded = false;\n    if (playerTransform && playerPhys) {\n      const body = playerPhys.body;\n      const vel2 =\n        typeof body.getLinearVelocity === \"function\"\n          ? body.getLinearVelocity()\n          : body.linearVelocity;\n      const velY = vel2.y;\n\n      for (const [, platform] of ecs.platforms) {\n        const expectedCenterY = platform.topY + playerHalfHeight;\n        if (\n          Math.abs(playerTransform.position[1] - expectedCenterY) < 0.05 &&\n          velY <= 0.1\n        ) {\n          playerGrounded = true;\n          break;\n        }\n      }\n    }\n\n    // ---------- Rotate collectibles & win condition ----------\n\n    for (const [e, coll] of ecs.collectibles) {\n      if (coll.isCollected) continue;\n      const t = ecs.transforms.get(e);\n      if (!t) continue;\n      t.rotation[1] += 2 * dt;\n      updateTransformMatrix(t);\n    }\n\n    for (const [e, win] of ecs.winConditions) {\n      if (win.completed) continue;\n      const t = ecs.transforms.get(e);\n      if (!t) continue;\n      t.rotation[1] += 2 * dt;\n      updateTransformMatrix(t);\n    }\n\n    // ---------- Collectible pickup ----------\n    let allCollected = true;\n    for (const [, coll] of ecs.collectibles) {\n      if (!coll.isCollected) {\n        allCollected = false;\n        break;\n      }\n    }\n\n    for (const [e, coll] of ecs.collectibles) {\n      if (coll.isCollected) continue;\n      const t = ecs.transforms.get(e);\n      if (!t) continue;\n      const dist = vec3.distance(playerPos, t.position);\n      if (dist < coll.triggerRadius) {\n        coll.isCollected = true;\n        globalCollectibles.set(coll.id, true);  // <--- persist it\n        console.log(\"Collectible picked up:\", e);\n      }\n    }\n\n\n    // ---------- Interactable check (Keys / Doors) ----------\n    for (const [e, obj] of ecs.interactables) {\n      const t = ecs.transforms.get(e);\n      if (!t) continue;\n\n      const dist = vec3.distance(playerPos, t.position);\n      if (dist < obj.triggerRadius) {\n        if (uiTimer <= 0) {\n          const t =\n            translations[\n              document.documentElement.lang as keyof typeof translations\n            ] || translations[\"en\"];\n          showUIMessage(t.interact, 0.5);\n        }\n\n        // handle input\n        if (Input.wasKeyPressed(\"KeyE\")) {\n          obj.onInteract();\n        }\n      }\n    }\n\n    // ---------- Win condition check ----------\n    if (allCollected) {\n      for (const [e, win] of ecs.winConditions) {\n        if (win.completed) continue;\n        const t = ecs.transforms.get(e);\n        if (!t) continue;\n        const dist = vec3.distance(playerPos, t.position);\n        if (dist < win.triggerRadius) {\n          win.completed = true;\n          currentSceneIndex++;\n\n          if (currentSceneIndex < scenes.length) {\n            console.log(`Loading scene ${currentSceneIndex + 1}...`);\n            world = loadScene(currentSceneIndex);\n            physicsAccumulator = 0;\n          } else {\n            const t =\n              translations[\n                document.documentElement.lang as keyof typeof translations\n              ] || translations.en;\n            alert(t.winMessage);\n          }\n        }\n      }\n    }\n\n    // ---------- Camera ----------\n    updateCamera();\n    shader.use();\n    const [ar, ag, ab] = getAmbientThemeColor(currentTheme);\n    gl.uniform3f(uAmbientColor, ar, ag, ab);\n\n    // ---------- Render ----------\n    for (const [e, rend] of ecs.renderables) {\n      const t = ecs.transforms.get(e);\n      if (!t) continue;\n\n      const coll = ecs.collectibles.get(e);\n      if (coll && coll.isCollected) continue;\n\n      const win = ecs.winConditions.get(e);\n      if (win && win.completed) continue;\n\n      gl.bindVertexArray(rend.drawable.vao);\n      mat4.multiply(tmp, vp, t.matrix);\n      mat4.copy(mvp, tmp);\n      gl.uniformMatrix4fv(uMVP, false, mvp);\n      gl.drawElements(\n        rend.drawable.mode,\n        rend.drawable.indexCount,\n        gl.UNSIGNED_SHORT,\n        0,\n      );\n    }\n\n    gl.bindVertexArray(null);\n\n    // ---------- UI ----------\n    // Save / Load / New Game shortcuts\n    if (Input.wasKeyPressed(\"KeyP\")) {\n      saveGame();   // P = save\n    }\n    if (Input.wasKeyPressed(\"KeyL\")) {\n      loadGame();   // L = load\n    }\n    if (Input.wasKeyPressed(\"KeyN\")) {\n      newGame();    // N = new game\n    }\n\n    renderUI(dt);\n    // Edge-triggered input bookkeeping\n    Input.update();\n  });\n\n  engine.start();\n}\n\nbootstrap();\n"],"names":["GLContext","canvas","gl","displayWidth","displayHeight","r","g","b","a","Engine","tick","time","deltaTime","safeDeltaTime","Shader","vertexSource","fragmentSource","vs","fs","program","info","name","source","type","shader","EPSILON","ARRAY_TYPE","create","out","glMatrix.ARRAY_TYPE","copy","identity","multiply","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b0","b1","b2","b3","translate","v","x","y","z","scale","rotateX","rad","s","c","rotateY","rotateZ","perspectiveNO","fovy","aspect","near","far","f","nf","perspective","lookAt","eye","center","up","x0","x1","x2","y0","y1","y2","z0","z1","z2","len","eyex","eyey","eyez","upx","upy","upz","centerx","centery","centerz","glMatrix.EPSILON","fromValues","set","distance","vec","stride","offset","count","fn","arg","i","l","Input","target","e","key","TouchController","text","bottom","left","transform","button","direction","length","theme","bgColor","interactBg","applyButtonTheme","currentButtonTheme","getPreferredTheme","touchController","mq","handleThemeChange","ev","translations","updateText","lang","html","VERT_SRC","FRAG_SRC","globalState","globalCollectibles","inventory","ECS","testScene","scene2","createDrawable","positions","colors","indices","mode","vao","vertexCount","vertexData","vbo","ibo","strideBytes","createBoxBody","opts","world","size","pos","move","density","updateTransformMatrix","t","m","mat4.identity","mat4.translate","mat4.rotateX","mat4.rotateY","mat4.rotateZ","mat4.scale","onInteract","obj","showUIMessage","buildScene","_gl","ecs","meshes","config","gridSize","sceneIndex","playerE","playerTransform","vec3.fromValues","mat4.create","playerBody","floorE","floorTransform","floorBody","winE","winTransform","index","collectibleId","cE","keyData","keyState","keyE","keyDrawable","doorData","doorState","doorE","doorDrawable","doorBody","platform","px","py","pz","sx","sy","sz","pE","body","topY","uiMessage","uiTimer","msg","duration","bootstrap","uiCanvas","uiCtx","SAVE_KEY","saveGame","playerPhys","playerEntity","save","currentSceneIndex","id","state","collected","loadGame","raw","data","loadScene","vec3.set","p","newGame","renderUI","dt","uiTextColor","glctx","uMVP","uAmbientColor","currentTheme","getAmbientThemeColor","getClearThemeColor","getUIForegroundColor","themeChangeHandler","clearWithTheme","scenes","cubePositions","cubeIndices","playerCubeColors","collectibleCubeColors","doorRedCube","doorBlueCube","keyPositions","keyIndices","keyRedColors","keyBlueColors","keyRedTriangle","keyBlueTriangle","platformCubeColors","playerCube","collectibleCube","platformCube","winPyramid","divisions","floorY","gridPositions","gridColors","gridIndices","baseIndex","floorGrid","newWorld","projection","view","vp","mvp","tmp","playerPos","vec3.create","updateCamera","mat4.perspective","mat4.lookAt","mat4.multiply","physicsAccumulator","fixedTimeStep","moveSpeed","jumpSpeed","playerHalfHeight","playerGrounded","vel","touchMovement","vx","vz","phys","vec3.copy","velY","expectedCenterY","coll","win","allCollected","vec3.distance","ar","ag","ab","rend","mat4.copy"],"mappings":"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","x_google_ignoreList":[3,4,5]}